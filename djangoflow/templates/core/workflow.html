{% extends "base.html" %}
{% load core_tags %}

{% block title %} Workflow {% endblock %}

{% block main_content %}

<ol class="breadcrumb">
  <li><a href="{% url 'workflows' %}">Home</a></li>
  <li class="active">{{ app_title }}</li>
</ol>
<a href="{% url 'create' app_title 'FirstActivity' 'Initial' %}" class="btn btn-primary" role="button">Create New Workflow</a>
<h3>{{ app_title }}</h3>
{% if instances %}
<table class="table table-bordered">
	<tr>
		<th>id</th>
		<th>status</th>
		<th>created</th>
		<th>updated</th>
		<th>tasks</th>
    </tr>
    {% for instance in instances %}
		<tr data-toggle="collapse" data-target="#demo">
			<td>{{instance.task.request.id}}</td>
			<td>{{instance.task.request.status}}</td>
			<td>{{instance.task.request.creation_date}}</td>
			<td>{{instance.task.request.last_updated}}</td>
			<td><span class="badge">{{ instance.task.request.tasks.count }}</span></td>
	    </tr>
	    {% if instance.task.request.tasks %}
		    <tr id="demo" class="collapse">
		    	<td colspan="5">
				    <table class="table table-bordered table-hover">
						<tr>
							<th>id</th>
							<th>status</th>
							<th>created</th>
							<th>updated</th>
							<th>action</th>
					    </tr>
					    {% for task in instance.task.request.tasks.all %}
							<tr>
								<td>{{task.id}}</td>
								<td>{{task.status}}</td>
								<td>{{task.creation_date}}</td>
								<td>{{task.last_updated}}</td>
								{% activity_title task.flow_ref_key app_title as act_title %}
								<td><a class="btn btn-primary btn-xs" href="{% url 'create' app_title act_title task.id %}">Start Task</a></td>
						    </tr>
					    {% endfor %}
					</table>
				</td>
			</tr>
		{% else %}
		    <p>No objects are available.</p>
		{% endif %}
    {% endfor %}
</table>
{% else %}
    <p>No objects are available.</p>
{% endif %}
{% endblock %}

